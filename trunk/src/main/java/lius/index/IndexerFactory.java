/* * Licensed to the Apache Software Foundation (ASF) under one or more * contributor license agreements.  See the NOTICE file distributed with * this work for additional information regarding copyright ownership. * The ASF licenses this file to You under the Apache License, Version 2.0 * (the "License"); you may not use this file except in compliance with * the License.  You may obtain a copy of the License at * *      http://www.apache.org/licenses/LICENSE-2.0 * * Unless required by applicable law or agreed to in writing, software * distributed under the License is distributed on an "AS IS" BASIS, * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. * See the License for the specific language governing permissions and * limitations under the License. */package lius.index;import java.io.File;import java.io.IOException;import java.io.InputStream;import java.net.URL;import java.util.ArrayList;import java.util.List;import java.util.Map;import lius.config.LiusConfig;import lius.index.javaobject.BeanIndexer;import lius.index.mixedindexing.MixedIndexer;import lius.index.util.LiusUtils;import org.apache.log4j.Logger;import org.springframework.core.io.ClassPathResource;import org.springframework.core.io.FileSystemResource;import org.springframework.core.io.Resource;import org.springframework.core.io.UrlResource;/** * @author Rida Benjelloun (ridabenjelloun@gmail.com) */public class IndexerFactory {    static Logger logger = Logger.getLogger(IndexerFactory.class);    public static IndexService getIndexer(LiusConfig lc) {        BeanIndexer indexer = new BeanIndexer();        indexer.setUp(lc);        return indexer;    }    public static IndexService getIndexer(Resource resource, LiusConfig lc) {        try {            IndexService result = null;            if (resource instanceof ClassPathResource) {                result = getIndexer(resource.getFile(), lc);            } else if (resource instanceof FileSystemResource) {                result = getIndexer(resource.getFile(), lc);            } else if (resource instanceof UrlResource) {                result = getIndexer(resource.getURL(), lc);            } else {                throw new IllegalArgumentException(                        "Can't find a indexer with a Resource of type ["                                + resource.getClass() + "]. The resource is ["                                + resource + "].");            }            return result;        } catch (IOException e) {            throw new IllegalArgumentException(e);        }    }    public static IndexService getIndexer(File file, LiusConfig lc) {        if (file.isDirectory()) {            return createFolderIndexer(lc);        } else {            return getIndexer(MimeTypeUtils.getMimeType(file), lc);        }    }    public static Indexer getIndexer(InputStream is, LiusConfig lc) {        return getIndexer(MimeTypeUtils.getMimeType(is), lc);    }    public static IndexService getIndexer(URL url, LiusConfig lc) {        return getIndexer(MimeTypeUtils.getMimeType(url), lc);    }    public static IndexService getIndexer(String mimeType, LiusConfig lc) {        Map mimeTypesClasses = lc.getMimeTypeClass();        if (mimeType == null || !mimeTypesClasses.containsKey(mimeType)) {            throw new IllegalStateException(                    "Can't find a configured indexer for mimeType [" + mimeType                            + "].");        }        return (IndexService) mimeTypesClasses.get(mimeType);    }    public static List getIndexersFromZipResource(Resource resource,            LiusConfig lc) throws IOException {        return getIndexersFromZipInputStream(resource.getInputStream(), lc);    }    public static List getIndexersFromZipInputStream(InputStream is,            LiusConfig lc) {        List indexers = new ArrayList();        List files = LiusUtils.unzip(is);        for (int i = 0; i < files.size(); i++) {            indexers.add(getIndexer((File) files.get(i), lc));        }        return indexers;    }    private static IndexService createFolderIndexer(LiusConfig lc) {        MixedIndexer indexer = new MixedIndexer();        indexer.setUp(lc);        return indexer;    }}